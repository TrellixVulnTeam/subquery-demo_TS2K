{"version":3,"file":"load.js","sourceRoot":"","sources":["../../src/project/load.ts"],"names":[],"mappings":";AAAA,gEAAgE;AAChE,sCAAsC;;;;;;AAEtC,4CAAoB;AACpB,gDAAwB;AACxB,sDAA2B;AAG3B,SAAgB,kBAAkB,CAAC,IAAY;IAC7C,MAAM,EAAC,GAAG,EAAC,GAAG,cAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IAC/B,IAAI,GAAG,KAAK,OAAO,IAAI,GAAG,KAAK,MAAM,IAAI,GAAG,KAAK,OAAO,EAAE;QACxD,MAAM,IAAI,KAAK,CAAC,aAAa,GAAG,gBAAgB,CAAC,CAAC;KACnD;IACD,MAAM,UAAU,GAAG,YAAE,CAAC,YAAY,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IAClD,OAAO,iBAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AAC/B,CAAC;AAPD,gDAOC;AAED,SAAgB,eAAe,CAAC,IAAY;IAC1C,IAAI,YAAY,GAAG,IAAI,CAAC;IACxB,IAAI,YAAE,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,YAAE,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,WAAW,EAAE,EAAE;QAC3D,MAAM,YAAY,GAAG,cAAI,CAAC,IAAI,CAAC,IAAI,EAAE,cAAc,CAAC,CAAC;QACrD,MAAM,YAAY,GAAG,cAAI,CAAC,IAAI,CAAC,IAAI,EAAE,cAAc,CAAC,CAAC;QACrD,IAAI,YAAE,CAAC,UAAU,CAAC,YAAY,CAAC,EAAE;YAC/B,YAAY,GAAG,YAAY,CAAC;SAC7B;aAAM,IAAI,YAAE,CAAC,UAAU,CAAC,YAAY,CAAC,EAAE;YACtC,YAAY,GAAG,YAAY,CAAC;SAC7B;aAAM;YACL,MAAM,IAAI,KAAK,CAAC,6CAA6C,IAAI,EAAE,CAAC,CAAC;SACtE;KACF;IACD,OAAO,YAAY,CAAC;AACtB,CAAC;AAdD,0CAcC;AAED,SAAgB,aAAa,CAAC,IAAY;IACxC,MAAM,QAAQ,GAAG,kBAAkB,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC;IAC3D,IAAK,QAAgB,CAAC,WAAW,KAAK,OAAO,EAAE;QAC7C,OAAO,cAAI,CAAC,IAAI,CAAC,IAAI,EAAG,QAAgB,CAAC,MAAM,CAAC,CAAC;KAClD;IACD,OAAO,cAAI,CAAC,IAAI,CAAC,IAAI,EAAG,QAAkC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AAC1E,CAAC;AAND,sCAMC","sourcesContent":["// Copyright 2020-2022 OnFinality Limited authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\nimport fs from 'fs';\nimport path from 'path';\nimport yaml from 'js-yaml';\nimport {ProjectManifestV0_2_0} from '../project/versioned';\n\nexport function loadFromJsonOrYaml(file: string): unknown {\n  const {ext} = path.parse(file);\n  if (ext !== '.yaml' && ext !== '.yml' && ext !== '.json') {\n    throw new Error(`Extension ${ext} not supported`);\n  }\n  const rawContent = fs.readFileSync(file, 'utf-8');\n  return yaml.load(rawContent);\n}\n\nexport function getManifestPath(file: string): string {\n  let manifestPath = file;\n  if (fs.existsSync(file) && fs.lstatSync(file).isDirectory()) {\n    const yamlFilePath = path.join(file, 'project.yaml');\n    const jsonFilePath = path.join(file, 'project.json');\n    if (fs.existsSync(yamlFilePath)) {\n      manifestPath = yamlFilePath;\n    } else if (fs.existsSync(jsonFilePath)) {\n      manifestPath = jsonFilePath;\n    } else {\n      throw new Error(`Could not find project manifest under dir ${file}`);\n    }\n  }\n  return manifestPath;\n}\n\nexport function getSchemaPath(file: string) {\n  const yamlFile = loadFromJsonOrYaml(getManifestPath(file));\n  if ((yamlFile as any).specVersion === '0.0.1') {\n    return path.join(file, (yamlFile as any).schema);\n  }\n  return path.join(file, (yamlFile as ProjectManifestV0_2_0).schema.file);\n}\n"]}